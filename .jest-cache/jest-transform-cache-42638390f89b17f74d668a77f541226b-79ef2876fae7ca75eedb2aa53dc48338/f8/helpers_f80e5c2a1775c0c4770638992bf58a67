0632b7e4d7479bef581c82f4f071f8b4
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.cn = exports.retry = exports.debounce = exports.removeLocalStorage = exports.getLocalStorage = exports.setLocalStorage = exports.getIpAddress = exports.getUserAgent = exports.generateRatingDistribution = exports.calculateAverageRating = exports.formatRating = exports.formatDate = exports.resizeImage = exports.isValidImageFile = exports.isValidPassword = exports.isValidEmail = exports.generateSessionId = exports.generateId = void 0;
const constants_1 = require("./constants");
/**
 * Génère un ID unique
 */
const generateId = () => {
    return Date.now().toString(36) + Math.random().toString(36).substring(2);
};
exports.generateId = generateId;
/**
 * Génère un ID de session unique pour les votes anonymes
 */
const generateSessionId = () => {
    const timestamp = Date.now();
    const random = Math.random().toString(36).substring(2);
    return `${timestamp}-${random}`;
};
exports.generateSessionId = generateSessionId;
/**
 * Valide une adresse email
 */
const isValidEmail = (email) => {
    return constants_1.VALIDATION_RULES.EMAIL.test(email);
};
exports.isValidEmail = isValidEmail;
/**
 * Valide un mot de passe
 */
const isValidPassword = (password) => {
    return password.length >= constants_1.VALIDATION_RULES.PASSWORD_MIN_LENGTH;
};
exports.isValidPassword = isValidPassword;
/**
 * Valide un fichier image
 */
const isValidImageFile = (file) => {
    return (constants_1.VALIDATION_RULES.ALLOWED_IMAGE_TYPES.indexOf(file.type) !== -1 &&
        file.size <= constants_1.VALIDATION_RULES.MAX_FILE_SIZE);
};
exports.isValidImageFile = isValidImageFile;
/**
 * Redimensionne une image
 */
const resizeImage = (file, maxWidth = 800, maxHeight = 600, quality = 0.8) => {
    return new Promise((resolve, reject) => {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        const img = new Image();
        img.onload = () => {
            // Calculer les nouvelles dimensions
            let { width, height } = img;
            if (width > maxWidth) {
                height = (height * maxWidth) / width;
                width = maxWidth;
            }
            if (height > maxHeight) {
                width = (width * maxHeight) / height;
                height = maxHeight;
            }
            canvas.width = width;
            canvas.height = height;
            if (ctx) {
                ctx.drawImage(img, 0, 0, width, height);
                canvas.toBlob((blob) => {
                    if (blob) {
                        resolve(blob);
                    }
                    else {
                        reject(new Error('Erreur lors du redimensionnement'));
                    }
                }, 'image/jpeg', quality);
            }
            else {
                reject(new Error('Impossible de créer le contexte canvas'));
            }
        };
        img.onerror = () => reject(new Error('Erreur lors du chargement de l\'image'));
        img.src = URL.createObjectURL(file);
    });
};
exports.resizeImage = resizeImage;
/**
 * Formate une date
 */
const formatDate = (date) => {
    return new Intl.DateTimeFormat('fr-FR', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
    }).format(date);
};
exports.formatDate = formatDate;
/**
 * Formate une note avec étoiles
 */
const formatRating = (rating) => {
    return `${rating}/5`;
};
exports.formatRating = formatRating;
/**
 * Calcule la moyenne des notes
 */
const calculateAverageRating = (ratings) => {
    if (ratings.length === 0)
        return 0;
    const sum = ratings.reduce((acc, rating) => acc + rating, 0);
    return Math.round((sum / ratings.length) * 10) / 10;
};
exports.calculateAverageRating = calculateAverageRating;
/**
 * Génère une distribution des notes
 */
const generateRatingDistribution = (ratings) => {
    const distribution = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
    ratings.forEach(rating => {
        if (rating >= 1 && rating <= 5) {
            distribution[rating]++;
        }
    });
    return distribution;
};
exports.generateRatingDistribution = generateRatingDistribution;
/**
 * Retourne l'User Agent du navigateur
 */
const getUserAgent = () => {
    return navigator.userAgent;
};
exports.getUserAgent = getUserAgent;
/**
 * Retourne l'adresse IP (approximative via service externe)
 */
const getIpAddress = async () => {
    try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
    }
    catch (error) {
        console.warn('Impossible de récupérer l\'IP:', error);
        return null;
    }
};
exports.getIpAddress = getIpAddress;
/**
 * Stocke une valeur dans le localStorage
 */
const setLocalStorage = (key, value) => {
    try {
        localStorage.setItem(key, JSON.stringify(value));
    }
    catch (error) {
        console.warn('Erreur lors du stockage local:', error);
    }
};
exports.setLocalStorage = setLocalStorage;
/**
 * Récupère une valeur du localStorage
 */
const getLocalStorage = (key, defaultValue) => {
    try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item) : defaultValue;
    }
    catch (error) {
        console.warn('Erreur lors de la récupération locale:', error);
        return defaultValue;
    }
};
exports.getLocalStorage = getLocalStorage;
/**
 * Supprime une valeur du localStorage
 */
const removeLocalStorage = (key) => {
    try {
        localStorage.removeItem(key);
    }
    catch (error) {
        console.warn('Erreur lors de la suppression locale:', error);
    }
};
exports.removeLocalStorage = removeLocalStorage;
/**
 * Débounce une fonction
 */
const debounce = (func, wait) => {
    let timeout;
    return (...args) => {
        clearTimeout(timeout);
        timeout = window.setTimeout(() => func(...args), wait);
    };
};
exports.debounce = debounce;
/**
 * Retry une fonction avec délai
 */
const retry = async (fn, maxRetries = 3, delay = 1000) => {
    let lastError = new Error('Une erreur est survenue');
    for (let i = 0; i < maxRetries; i++) {
        try {
            return await fn();
        }
        catch (error) {
            lastError = error;
            if (i < maxRetries - 1) {
                await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, i)));
            }
        }
    }
    throw new Error(lastError.message || 'Une erreur est survenue');
};
exports.retry = retry;
/**
 * Combine les classes CSS
 */
const cn = (...classes) => {
    return classes.filter(Boolean).join(' ');
};
exports.cn = cn;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiRDpcXERvY3VtZW50c1xcYWlwcm9qZXRzXFx2b3RlcHVibGljXFxzcmNcXHV0aWxzXFxoZWxwZXJzLnRzIiwibWFwcGluZ3MiOiI7OztBQUFBLDJDQUErQztBQUUvQzs7R0FFRztBQUNJLE1BQU0sVUFBVSxHQUFHLEdBQVcsRUFBRTtJQUNyQyxPQUFPLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDM0UsQ0FBQyxDQUFDO0FBRlcsUUFBQSxVQUFVLGNBRXJCO0FBRUY7O0dBRUc7QUFDSSxNQUFNLGlCQUFpQixHQUFHLEdBQVcsRUFBRTtJQUM1QyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDN0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkQsT0FBTyxHQUFHLFNBQVMsSUFBSSxNQUFNLEVBQUUsQ0FBQztBQUNsQyxDQUFDLENBQUM7QUFKVyxRQUFBLGlCQUFpQixxQkFJNUI7QUFFRjs7R0FFRztBQUNJLE1BQU0sWUFBWSxHQUFHLENBQUMsS0FBYSxFQUFXLEVBQUU7SUFDckQsT0FBTyw0QkFBZ0IsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQzVDLENBQUMsQ0FBQztBQUZXLFFBQUEsWUFBWSxnQkFFdkI7QUFFRjs7R0FFRztBQUNJLE1BQU0sZUFBZSxHQUFHLENBQUMsUUFBZ0IsRUFBVyxFQUFFO0lBQzNELE9BQU8sUUFBUSxDQUFDLE1BQU0sSUFBSSw0QkFBZ0IsQ0FBQyxtQkFBbUIsQ0FBQztBQUNqRSxDQUFDLENBQUM7QUFGVyxRQUFBLGVBQWUsbUJBRTFCO0FBRUY7O0dBRUc7QUFDSSxNQUFNLGdCQUFnQixH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UUFBZ0IsSUFBSSxFQUNSLEVBQUU7SUFDZCxJQUFJLFNBQVMsR0FBVSxJQUFJLEtBQUssQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0lBRTVELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxVQUFVLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNwQyxJQUFJLENBQUM7WUFDSCxPQUFPLE1BQU0sRUFBRSxFQUFFLENBQUM7UUFDcEIsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixTQUFTLEdBQUcsS0FBYyxDQUFDO1lBQzNCLElBQUksQ0FBQyxHQUFHLFVBQVUsR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDdkIsTUFBTSxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1RSxDQUFDO1FBQ0gsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLElBQUkseUJBQXlCLENBQUMsQ0FBQztBQUNsRSxDQUFDLENBQUM7QUFuQlcsUUFBQSxLQUFLLFNBbUJoQjtBQUVGOztHQUVHO0FBQ0ksTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLE9BQThDLEVBQVUsRUFBRTtJQUM5RSxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0FBQzNDLENBQUMsQ0FBQztBQUZXLFFBQUEsRUFBRSxNQUViIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkQ6XFxEb2N1bWVudHNcXGFpcHJvamV0c1xcdm90ZXB1YmxpY1xcc3JjXFx1dGlsc1xcaGVscGVycy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBWQUxJREFUSU9OX1JVTEVTIH0gZnJvbSAnLi9jb25zdGFudHMnO1xyXG5cclxuLyoqXHJcbiAqIEfDqW7DqHJlIHVuIElEIHVuaXF1ZVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdlbmVyYXRlSWQgPSAoKTogc3RyaW5nID0+IHtcclxuICByZXR1cm4gRGF0ZS5ub3coKS50b1N0cmluZygzNikgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMik7XHJcbn07XHJcblxyXG4vKipcclxuICogR8OpbsOocmUgdW4gSUQgZGUgc2Vzc2lvbiB1bmlxdWUgcG91ciBsZXMgdm90ZXMgYW5vbnltZXNcclxuICovXHJcbmV4cG9ydCBjb25zdCBnZW5lcmF0ZVNlc3Npb25JZCA9ICgpOiBzdHJpbmcgPT4ge1xyXG4gIGNvbnN0IHRpbWVzdGFtcCA9IERhdGUubm93KCk7XHJcbiAgY29uc3QgcmFuZG9tID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIpO1xyXG4gIHJldHVybiBgJHt0aW1lc3RhbXB9LSR7cmFuZG9tfWA7XHJcbn07XHJcblxyXG4vKipcclxuICogVmFsaWRlIHVuZSBhZHJlc3NlIGVtYWlsXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNWYWxpZEVtYWlsID0gKGVtYWlsOiBzdHJpbmcpOiBib29sZWFuID0+IHtcclxuICByZXR1cm4gVkFMSURBVElPTl9SVUxFUy5FTUFJTC50ZXN0KGVtYWlsKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBWYWxpZGUgdW4gbW90IGRlIHBhc3NlXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgaXNWYWxpZFBhc3N3b3JkID0gKHBhc3N3b3JkOiBzdHJpbmcpOiBib29sZWFuID0+IHtcclxuICByZXR1cm4gcGFzc3dvcmQubGVuZ3RoID49IFZBTElEQVRJT05fUlVMRVMuUEFTU1dPUkRfTUlOX0xFTkdUSDtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBWYWxpZGUgdW4gZmljaGllciBpbWFnZVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGlzVmFsaWRJbWFnZUZpbGUgPSAoZmlsZTogRmlsZSk6IGJvb2xlYW4gPT4ge1xyXG4gIHJldHVybiAoXHJcbiAgICBWQUxJREFUSU9OX1JVTEVTLkFMTE9XRURfSU1BR0VfVFlQRVMuaW5kZXhPZihmaWxlLnR5cGUpICE9PSAtMSAmJlxyXG4gICAgZmlsZS5zaXplIDw9IFZBTElEQVRJT05fUlVMRVMuTUFYX0ZJTEVfU0laRVxyXG4gICk7XHJcbn07XHJcblxyXG4vKipcclxuICogUmVkaW1lbnNpb25uZSB1bmUgaW1hZ2VcclxuICovXHJcbmV4cG9ydCBjb25zdCByZXNpemVJbWFnZSA9IChcclxuICBmaWxlOiBGaWxlLFxyXG4gIG1heFdpZHRoOiBudW1iZXIgPSA4MDAsXHJcbiAgbWF4SGVpZ2h0OiBudW1iZXIgPSA2MDAsXHJcbiAgcXVhbGl0eTogbnVtYmVyID0gMC44XHJcbik6IFByb21pc2U8QmxvYj4gPT4ge1xyXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcclxuICAgIGNvbnN0IGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcblxyXG4gICAgaW1nLm9ubG9hZCA9ICgpID0+IHtcclxuICAgICAgLy8gQ2FsY3VsZXIgbGVzIG5vdXZlbGxlcyBkaW1lbnNpb25zXHJcbiAgICAgIGxldCB7IHdpZHRoLCBoZWlnaHQgfSA9IGltZztcclxuICAgICAgXHJcbiAgICAgIGlmICh3aWR0aCA+IG1heFdpZHRoKSB7XHJcbiAgICAgICAgaGVpZ2h0ID0gKGhlaWdodCAqIG1heFdpZHRoKSAvIHdpZHRoO1xyXG4gICAgICAgIHdpZHRoID0gbWF4V2lkdGg7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGlmIChoZWlnaHQgPiBtYXhIZWlnaHQpIHtcclxuICAgICAgICB3aWR0aCA9ICh3aWR0aCAqIG1heEhlaWdodCkgLyBoZWlnaHQ7XHJcbiAgICAgICAgaGVpZ2h0ID0gbWF4SGVpZ2h0O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcclxuICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcclxuXHJcbiAgICAgIGlmIChjdHgpIHtcclxuICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgd2lkdGgsIGhlaWdodCk7XHJcbiAgICAgICAgY2FudmFzLnRvQmxvYihcclxuICAgICAgICAgIChibG9iKSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChibG9iKSB7XHJcbiAgICAgICAgICAgICAgcmVzb2x2ZShibG9iKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdFcnJldXIgbG9ycyBkdSByZWRpbWVuc2lvbm5lbWVudCcpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSxcclxuICAgICAgICAgICdpbWFnZS9qcGVnJyxcclxuICAgICAgICAgIHF1YWxpdHlcclxuICAgICAgICApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ0ltcG9zc2libGUgZGUgY3LDqWVyIGxlIGNvbnRleHRlIGNhbnZhcycpKTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBpbWcub25lcnJvciA9ICgpID0+IHJlamVjdChuZXcgRXJyb3IoJ0VycmV1ciBsb3JzIGR1IGNoYXJnZW1lbnQgZGUgbFxcJ2ltYWdlJykpO1xyXG4gICAgaW1nLnNyYyA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZmlsZSk7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogRm9ybWF0ZSB1bmUgZGF0ZVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGZvcm1hdERhdGUgPSAoZGF0ZTogRGF0ZSk6IHN0cmluZyA9PiB7XHJcbiAgcmV0dXJuIG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KCdmci1GUicsIHtcclxuICAgIHllYXI6ICdudW1lcmljJyxcclxuICAgIG1vbnRoOiAnbG9uZycsXHJcbiAgICBkYXk6ICdudW1lcmljJyxcclxuICAgIGhvdXI6ICcyLWRpZ2l0JyxcclxuICAgIG1pbnV0ZTogJzItZGlnaXQnLFxyXG4gIH0pLmZvcm1hdChkYXRlKTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBGb3JtYXRlIHVuZSBub3RlIGF2ZWMgw6l0b2lsZXNcclxuICovXHJcbmV4cG9ydCBjb25zdCBmb3JtYXRSYXRpbmcgPSAocmF0aW5nOiBudW1iZXIpOiBzdHJpbmcgPT4ge1xyXG4gIHJldHVybiBgJHtyYXRpbmd9LzVgO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENhbGN1bGUgbGEgbW95ZW5uZSBkZXMgbm90ZXNcclxuICovXHJcbmV4cG9ydCBjb25zdCBjYWxjdWxhdGVBdmVyYWdlUmF0aW5nID0gKHJhdGluZ3M6IG51bWJlcltdKTogbnVtYmVyID0+IHtcclxuICBpZiAocmF0aW5ncy5sZW5ndGggPT09IDApIHJldHVybiAwO1xyXG4gIGNvbnN0IHN1bSA9IHJhdGluZ3MucmVkdWNlKChhY2MsIHJhdGluZykgPT4gYWNjICsgcmF0aW5nLCAwKTtcclxuICByZXR1cm4gTWF0aC5yb3VuZCgoc3VtIC8gcmF0aW5ncy5sZW5ndGgpICogMTApIC8gMTA7XHJcbn07XHJcblxyXG4vKipcclxuICogR8OpbsOocmUgdW5lIGRpc3RyaWJ1dGlvbiBkZXMgbm90ZXNcclxuICovXHJcbmV4cG9ydCBjb25zdCBnZW5lcmF0ZVJhdGluZ0Rpc3RyaWJ1dGlvbiA9IChyYXRpbmdzOiBudW1iZXJbXSk6IFJlY29yZDxudW1iZXIsIG51bWJlcj4gPT4ge1xyXG4gIGNvbnN0IGRpc3RyaWJ1dGlvbjogUmVjb3JkPG51bWJlciwgbnVtYmVyPiA9IHsgMTogMCwgMjogMCwgMzogMCwgNDogMCwgNTogMCB9O1xyXG4gIFxyXG4gIHJhdGluZ3MuZm9yRWFjaChyYXRpbmcgPT4ge1xyXG4gICAgaWYgKHJhdGluZyA+PSAxICYmIHJhdGluZyA8PSA1KSB7XHJcbiAgICAgIGRpc3RyaWJ1dGlvbltyYXRpbmddKys7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgXHJcbiAgcmV0dXJuIGRpc3RyaWJ1dGlvbjtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBSZXRvdXJuZSBsJ1VzZXIgQWdlbnQgZHUgbmF2aWdhdGV1clxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldFVzZXJBZ2VudCA9ICgpOiBzdHJpbmcgPT4ge1xyXG4gIHJldHVybiBuYXZpZ2F0b3IudXNlckFnZW50O1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFJldG91cm5lIGwnYWRyZXNzZSBJUCAoYXBwcm94aW1hdGl2ZSB2aWEgc2VydmljZSBleHRlcm5lKVxyXG4gKi9cclxuZXhwb3J0IGNvbnN0IGdldElwQWRkcmVzcyA9IGFzeW5jICgpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+ID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkuaXBpZnkub3JnP2Zvcm1hdD1qc29uJyk7XHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgcmV0dXJuIGRhdGEuaXA7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUud2FybignSW1wb3NzaWJsZSBkZSByw6ljdXDDqXJlciBsXFwnSVA6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFN0b2NrZSB1bmUgdmFsZXVyIGRhbnMgbGUgbG9jYWxTdG9yYWdlXHJcbiAqL1xyXG5leHBvcnQgY29uc3Qgc2V0TG9jYWxTdG9yYWdlID0gKGtleTogc3RyaW5nLCB2YWx1ZTogYW55KTogdm9pZCA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkodmFsdWUpKTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS53YXJuKCdFcnJldXIgbG9ycyBkdSBzdG9ja2FnZSBsb2NhbDonLCBlcnJvcik7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIFLDqWN1cMOocmUgdW5lIHZhbGV1ciBkdSBsb2NhbFN0b3JhZ2VcclxuICovXHJcbmV4cG9ydCBjb25zdCBnZXRMb2NhbFN0b3JhZ2UgPSA8VD4oa2V5OiBzdHJpbmcsIGRlZmF1bHRWYWx1ZTogVCk6IFQgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBpdGVtID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oa2V5KTtcclxuICAgIHJldHVybiBpdGVtID8gSlNPTi5wYXJzZShpdGVtKSA6IGRlZmF1bHRWYWx1ZTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS53YXJuKCdFcnJldXIgbG9ycyBkZSBsYSByw6ljdXDDqXJhdGlvbiBsb2NhbGU6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogU3VwcHJpbWUgdW5lIHZhbGV1ciBkdSBsb2NhbFN0b3JhZ2VcclxuICovXHJcbmV4cG9ydCBjb25zdCByZW1vdmVMb2NhbFN0b3JhZ2UgPSAoa2V5OiBzdHJpbmcpOiB2b2lkID0+IHtcclxuICB0cnkge1xyXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS53YXJuKCdFcnJldXIgbG9ycyBkZSBsYSBzdXBwcmVzc2lvbiBsb2NhbGU6JywgZXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKlxyXG4gKiBEw6lib3VuY2UgdW5lIGZvbmN0aW9uXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgZGVib3VuY2UgPSA8VCBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gYW55PihcclxuICBmdW5jOiBULFxyXG4gIHdhaXQ6IG51bWJlclxyXG4pOiAoKC4uLmFyZ3M6IFBhcmFtZXRlcnM8VD4pID0+IHZvaWQpID0+IHtcclxuICBsZXQgdGltZW91dDogbnVtYmVyO1xyXG4gIFxyXG4gIHJldHVybiAoLi4uYXJnczogUGFyYW1ldGVyczxUPikgPT4ge1xyXG4gICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xyXG4gICAgdGltZW91dCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IGZ1bmMoLi4uYXJncyksIHdhaXQpO1xyXG4gIH07XHJcbn07XHJcblxyXG4vKipcclxuICogUmV0cnkgdW5lIGZvbmN0aW9uIGF2ZWMgZMOpbGFpXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgcmV0cnkgPSBhc3luYyA8VD4oXHJcbiAgZm46ICgpID0+IFByb21pc2U8VD4sXHJcbiAgbWF4UmV0cmllczogbnVtYmVyID0gMyxcclxuICBkZWxheTogbnVtYmVyID0gMTAwMFxyXG4pOiBQcm9taXNlPFQ+ID0+IHtcclxuICBsZXQgbGFzdEVycm9yOiBFcnJvciA9IG5ldyBFcnJvcignVW5lIGVycmV1ciBlc3Qgc3VydmVudWUnKTtcclxuICBcclxuICBmb3IgKGxldCBpID0gMDsgaSA8IG1heFJldHJpZXM7IGkrKykge1xyXG4gICAgdHJ5IHtcclxuICAgICAgcmV0dXJuIGF3YWl0IGZuKCk7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsYXN0RXJyb3IgPSBlcnJvciBhcyBFcnJvcjtcclxuICAgICAgaWYgKGkgPCBtYXhSZXRyaWVzIC0gMSkge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBkZWxheSAqIE1hdGgucG93KDIsIGkpKSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgdGhyb3cgbmV3IEVycm9yKGxhc3RFcnJvci5tZXNzYWdlIHx8ICdVbmUgZXJyZXVyIGVzdCBzdXJ2ZW51ZScpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIENvbWJpbmUgbGVzIGNsYXNzZXMgQ1NTXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgY24gPSAoLi4uY2xhc3NlczogKHN0cmluZyB8IHVuZGVmaW5lZCB8IG51bGwgfCBmYWxzZSlbXSk6IHN0cmluZyA9PiB7XHJcbiAgcmV0dXJuIGNsYXNzZXMuZmlsdGVyKEJvb2xlYW4pLmpvaW4oJyAnKTtcclxufTsgIl0sInZlcnNpb24iOjN9