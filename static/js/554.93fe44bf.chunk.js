"use strict";(self.webpackChunkprix_du_public=self.webpackChunkprix_du_public||[]).push([[554],{5554:(e,s,r)=>{r.r(s),r.d(s,{AdminQRCodesPage:()=>g});var t=r(5043),n=r(5475),a=r(5469),o=r(2681),i=r(7104),c=r(2754),l=r(5087),d=r(7929),m=r(3560),h=r(8970);const u=async(e,s)=>{try{const s=`${window.location.origin}/votepublic/seance/${e}`;return await h.toDataURL(s,{width:300,margin:2,color:{dark:"#000000",light:"#FFFFFF"}})}catch(r){throw console.error("Erreur lors de la g\xe9n\xe9ration du QR code:",r),new Error("Impossible de g\xe9n\xe9rer le QR code")}};var x=r(579);const g=()=>{const[e,s]=(0,t.useState)([]),[r,h]=(0,t.useState)(!0),[g,p]=(0,t.useState)({}),{showSuccess:f,showError:b}=(0,m.E)(),w=(0,t.useCallback)(async()=>{try{h(!0);const r=await(0,d.q5)();s(r);const t={};for(const s of r)try{const e=await u(s.id,s.nom);t[s.id]=e}catch(e){console.error(`Erreur lors de la g\xe9n\xe9ration du QR code pour ${s.nom}:`,e)}p(t)}catch(e){console.error("Erreur lors du chargement des s\xe9ances:",e),b("Erreur de chargement",e.message||"Impossible de charger les s\xe9ances")}finally{h(!1)}},[b]);(0,t.useEffect)(()=>{w()},[w]);const y=async(e,s)=>{try{await(async(e,s)=>{try{const r=await u(e),t=document.createElement("a");t.href=r,t.download=`qr-code-${s.replace(/[^a-z0-9]/gi,"-").toLowerCase()}.png`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(r){throw console.error("Erreur lors du t\xe9l\xe9chargement du QR code:",r),new Error("Impossible de t\xe9l\xe9charger le QR code")}})(e,s),f("QR Code t\xe9l\xe9charg\xe9",`Le QR code pour "${s}" a \xe9t\xe9 t\xe9l\xe9charg\xe9 avec succ\xe8s`)}catch(r){b("Erreur de t\xe9l\xe9chargement",r.message||"Impossible de t\xe9l\xe9charger le QR code")}},j=async(e,s)=>{try{await(async(e,s)=>{try{const r=await u(e),t=window.open("","_blank");if(!t)throw new Error("Impossible d'ouvrir la fen\xeatre d'impression");t.document.write(`\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <title>QR Code - ${s}</title>\n          <style>\n            body {\n              font-family: Arial, sans-serif;\n              text-align: center;\n              padding: 20px;\n              margin: 0;\n            }\n            .qr-container {\n              display: flex;\n              flex-direction: column;\n              align-items: center;\n              justify-content: center;\n              min-height: 100vh;\n            }\n            .qr-code {\n              margin: 20px 0;\n            }\n            .seance-info {\n              margin: 20px 0;\n              font-size: 18px;\n            }\n            .instructions {\n              margin: 20px 0;\n              font-size: 14px;\n              color: #666;\n            }\n            @media print {\n              body { margin: 0; }\n              .qr-container { min-height: auto; }\n            }\n          </style>\n        </head>\n        <body>\n          <div class="qr-container">\n            <h1>QR Code - ${s}</h1>\n            <div class="qr-code">\n              <img src="${r}" alt="QR Code pour ${s}" />\n            </div>\n            <div class="seance-info">\n              <p><strong>S\xe9ance:</strong> ${s}</p>\n              <p><strong>URL:</strong> ${window.location.origin}/votepublic/seance/${e}</p>\n            </div>\n            <div class="instructions">\n              <p>Scannez ce QR code pour acc\xe9der \xe0 la page de vote de cette s\xe9ance</p>\n            </div>\n          </div>\n        </body>\n      </html>\n    `),t.document.close(),t.focus(),setTimeout(()=>{t.print(),t.close()},500)}catch(r){throw console.error("Erreur lors de l'impression du QR code:",r),new Error("Impossible d'imprimer le QR code")}})(e,s),f("Impression lanc\xe9e",`Impression du QR code pour "${s}" lanc\xe9e`)}catch(r){b("Erreur d'impression",r.message||"Impossible d'imprimer le QR code")}};return r?(0,x.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,x.jsx)("p",{className:"mt-4 text-gray-600",children:"Chargement des s\xe9ances..."})]})}):(0,x.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,x.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,x.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,x.jsx)("div",{className:"py-6",children:(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,x.jsxs)(n.N_,{to:"/admin",className:"inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[(0,x.jsx)(a.A,{className:"w-4 h-4 mr-2"}),"Retour"]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"QR Codes"}),(0,x.jsx)("p",{className:"mt-1 text-gray-600",children:"G\xe9n\xe9rez et g\xe9rez les QR codes pour les s\xe9ances"})]})]}),(0,x.jsxs)("button",{className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[(0,x.jsx)(o.A,{className:"w-4 h-4 mr-2"}),"G\xe9n\xe9rer tous les QR codes"]})]})})})}),(0,x.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,x.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,x.jsx)(o.A,{className:"w-6 h-6 text-blue-600"})}),(0,x.jsxs)("div",{className:"ml-4",children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total s\xe9ances"}),(0,x.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,x.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,x.jsx)(o.A,{className:"w-6 h-6 text-green-600"})}),(0,x.jsxs)("div",{className:"ml-4",children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"QR codes g\xe9n\xe9r\xe9s"}),(0,x.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.length})]})]})}),(0,x.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,x.jsxs)("div",{className:"flex items-center",children:[(0,x.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg",children:(0,x.jsx)(o.A,{className:"w-6 h-6 text-yellow-600"})}),(0,x.jsxs)("div",{className:"ml-4",children:[(0,x.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"S\xe9ances actives"}),(0,x.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.filter(e=>e.isActive).length})]})]})})]}),(0,x.jsxs)("div",{className:"bg-white rounded-lg shadow-sm",children:[(0,x.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,x.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["QR Codes des s\xe9ances (",e.length,")"]})}),0===e.length?(0,x.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,x.jsx)(o.A,{className:"w-12 h-12 mx-auto text-gray-300 mb-4"}),(0,x.jsx)("p",{children:"Aucune s\xe9ance trouv\xe9e"}),(0,x.jsx)("p",{className:"text-sm",children:"Cr\xe9ez d'abord des s\xe9ances pour g\xe9n\xe9rer des QR codes"})]}):(0,x.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 p-6",children:e.map(e=>{return(0,x.jsx)("div",{className:"bg-gray-50 rounded-lg p-6 border border-gray-200",children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("div",{className:"w-32 h-32 mx-auto bg-white rounded-lg border-2 border-gray-300 flex items-center justify-center mb-4",children:g[e.id]?(0,x.jsx)("img",{src:g[e.id],alt:`QR Code pour ${e.nom}`,className:"w-full h-full object-contain p-2"}):(0,x.jsx)(o.A,{className:"w-16 h-16 text-gray-400"})}),(0,x.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:e.nom}),(0,x.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:[(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Date:"})," ",e.date.toLocaleDateString("fr-FR")]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Heure:"})," ",e.heure]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Films:"})," ",e.films.length]})]}),(0,x.jsxs)("div",{className:"text-xs text-gray-500 mb-4 break-all",children:[(0,x.jsx)("strong",{children:"URL:"})," ",(s=e.id,`${window.location.origin}/votepublic/seance/${s}`)]}),(0,x.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,x.jsxs)("button",{onClick:()=>y(e.id,e.nom),className:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[(0,x.jsx)(i.A,{className:"w-3 h-3 mr-1"}),"T\xe9l\xe9charger"]}),(0,x.jsxs)("button",{onClick:()=>j(e.id,e.nom),className:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[(0,x.jsx)(c.A,{className:"w-3 h-3 mr-1"}),"Imprimer"]}),(0,x.jsxs)(n.N_,{to:`/seance/${e.id}`,target:"_blank",className:"inline-flex items-center px-3 py-1 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500",children:[(0,x.jsx)(l.A,{className:"w-3 h-3 mr-1"}),"Voir"]})]}),(0,x.jsx)("div",{className:"mt-4",children:(0,x.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full "+(e.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.isActive?"Active":"Inactive"})})]})},e.id);var s})})]}),(0,x.jsxs)("div",{className:"mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,x.jsx)("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"Instructions d'utilisation"}),(0,x.jsxs)("ul",{className:"text-sm text-blue-800 space-y-1",children:[(0,x.jsx)("li",{children:"\u2022 Chaque s\xe9ance g\xe9n\xe8re automatiquement un QR code unique"}),(0,x.jsx)("li",{children:"\u2022 Les QR codes pointent vers la page de vote de la s\xe9ance"}),(0,x.jsx)("li",{children:"\u2022 T\xe9l\xe9chargez ou imprimez les QR codes pour les afficher sur place"}),(0,x.jsx)("li",{children:"\u2022 Les utilisateurs peuvent scanner le QR code pour voter"}),(0,x.jsx)("li",{children:"\u2022 Seules les s\xe9ances actives sont accessibles aux votes"})]})]})]})]})}},6925:(e,s,r)=>{r.d(s,{$C:()=>t,$t:()=>a,Lg:()=>c,SP:()=>o,ZB:()=>i,cn:()=>l,f6:()=>n});r(4413);const t=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),n=()=>`${Date.now()}-${Math.random().toString(36).substring(2)}`,a=()=>navigator.userAgent,o=async()=>{try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return console.warn("Impossible de r\xe9cup\xe9rer l'IP:",e),null}},i=(e,s)=>{try{localStorage.setItem(e,JSON.stringify(s))}catch(r){console.warn("Erreur lors du stockage local:",r)}},c=(e,s)=>{try{const r=localStorage.getItem(e);return r?JSON.parse(r):s}catch(r){return console.warn("Erreur lors de la r\xe9cup\xe9ration locale:",r),s}},l=function(){for(var e=arguments.length,s=new Array(e),r=0;r<e;r++)s[r]=arguments[r];return s.filter(Boolean).join(" ")}},7929:(e,s,r)=>{r.d(s,{L6:()=>m,Si:()=>d,We:()=>u,Xb:()=>h,gc:()=>c,q5:()=>l});var t=r(4455),n=r(5472),a=r(6925);const o="seances",i="films",c=async e=>{try{if(e.films.length<1||e.films.length>5)throw new Error("Une s\xe9ance doit contenir entre 1 et 5 films");const s=e.films.map(e=>(0,n.x7)((0,n.H9)(t.db,i,e))),r=(await Promise.all(s)).map((s,r)=>({snapshot:s,filmId:e.films[r]})).filter(e=>{let{snapshot:s}=e;return!s.exists()});if(r.length>0)throw new Error(`Films non trouv\xe9s: ${r.map(e=>e.filmId).join(", ")}`);const c=(0,a.$C)(),l=x(c),d={nom:e.nom,date:e.date,heure:e.heure,films:e.films,qrCodeUrl:l,isActive:!0,createdAt:new Date,updatedAt:new Date,...e.description&&{description:e.description}};return{id:(await(0,n.gS)((0,n.collection)(t.db,o),d)).id,...d}}catch(s){throw console.error("Erreur lors de la cr\xe9ation de la s\xe9ance:",s),s}},l=async()=>{try{const e=(0,n.P)((0,n.collection)(t.db,o),(0,n.My)("date","desc")),s=await(0,n.getDocs)(e),r=[];return s.forEach(e=>{const s=e.data();r.push({id:e.id,nom:s.nom,description:s.description,date:s.date.toDate(),heure:s.heure,films:s.films,qrCodeUrl:s.qrCodeUrl,isActive:s.isActive,createdAt:s.createdAt.toDate(),updatedAt:s.updatedAt.toDate()})}),r}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration des s\xe9ances:",e),e}},d=async e=>{try{const s=(0,n.H9)(t.db,o,e),r=await(0,n.x7)(s);if(r.exists()){const e=r.data();return{id:r.id,nom:e.nom,description:e.description,date:e.date.toDate(),heure:e.heure,films:e.films,qrCodeUrl:e.qrCodeUrl,isActive:e.isActive,createdAt:e.createdAt.toDate(),updatedAt:e.updatedAt.toDate()}}return null}catch(s){throw console.error("Erreur lors de la r\xe9cup\xe9ration de la s\xe9ance:",s),s}},m=async(e,s)=>{try{console.log("Mise \xe0 jour de la s\xe9ance:",e,s);const r=(0,n.H9)(t.db,o,e),a={updatedAt:new Date};if(void 0!==s.nom&&(a.nom=s.nom),void 0!==s.description&&(a.description=s.description),void 0!==s.heure&&(a.heure=s.heure),void 0!==s.films&&(a.films=s.films),void 0!==s.date&&(a.date=s.date),s.films&&(s.films.length<1||s.films.length>5))throw new Error("Une s\xe9ance doit contenir entre 1 et 5 films");console.log("Donn\xe9es de mise \xe0 jour:",a),await(0,n.mZ)(r,a),console.log("S\xe9ance mise \xe0 jour avec succ\xe8s")}catch(r){throw console.error("Erreur lors de la mise \xe0 jour de la s\xe9ance:",r),r}},h=async e=>{try{const s=(0,n.H9)(t.db,o,e);await(0,n.kd)(s)}catch(s){throw console.error("Erreur lors de la suppression de la s\xe9ance:",s),s}},u=async(e,s)=>{try{const r=(0,n.H9)(t.db,o,e);await(0,n.mZ)(r,{isActive:s,updatedAt:new Date})}catch(r){throw console.error("Erreur lors de la modification du statut de la s\xe9ance:",r),r}},x=e=>{const s=window.location.origin;return`https://api.qrserver.com/v1/create-qr-code/?${new URLSearchParams({size:"300x300",data:`${s}/seance/${e}`,format:"png"}).toString()}`}}}]);
//# sourceMappingURL=554.93fe44bf.chunk.js.map