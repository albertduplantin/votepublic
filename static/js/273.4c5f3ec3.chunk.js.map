{"version":3,"file":"static/js/273.4c5f3ec3.chunk.js","mappings":"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","sources":["services/filmService.ts","../node_modules/lucide-react/src/icons/clock.ts","../node_modules/lucide-react/src/icons/message-square.ts","../node_modules/lucide-react/src/icons/check-circle.ts","services/voteService.ts","pages/VotePage.tsx"],"sourcesContent":["import {\r\n  collection,\r\n  doc,\r\n  addDoc,\r\n  updateDoc,\r\n  deleteDoc,\r\n  getDoc,\r\n  getDocs,\r\n  query,\r\n  orderBy,\r\n  onSnapshot,\r\n} from 'firebase/firestore';\r\nimport { ref, uploadBytes, getDownloadURL, deleteObject } from 'firebase/storage';\r\nimport { db, storage } from './firebase';\r\nimport { Film, FilmFormData } from '../types';\r\nimport { COLLECTIONS } from '../utils/constants';\r\nimport { generateId, resizeImage } from '../utils/helpers';\r\n\r\n/**\r\n * Ajouter un nouveau film\r\n */\r\nexport const addFilm = async (data: FilmFormData): Promise<Film> => {\r\n  try {\r\n    let posterUrl = '';\r\n\r\n    // Upload et redimensionner l'affiche si fournie\r\n    if (data.poster) {\r\n      const resizedImage = await resizeImage(data.poster, 800, 600);\r\n      const posterRef = ref(storage, `posters/${generateId()}.jpg`);\r\n      await uploadBytes(posterRef, resizedImage);\r\n      posterUrl = await getDownloadURL(posterRef);\r\n    }\r\n\r\n    const filmData: Omit<Film, 'id'> = {\r\n      titre: data.titre.trim(),\r\n      realisateur: data.realisateur.trim(),\r\n      synopsis: data.synopsis.trim(),\r\n      posterUrl,\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    };\r\n\r\n    const docRef = await addDoc(collection(db, COLLECTIONS.FILMS), filmData);\r\n\r\n    return {\r\n      id: docRef.id,\r\n      ...filmData,\r\n    };\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de l\\'ajout du film');\r\n  }\r\n};\r\n\r\n/**\r\n * Mettre √† jour un film\r\n */\r\nexport const updateFilm = async (\r\n  id: string,\r\n  data: Partial<FilmFormData>\r\n): Promise<void> => {\r\n  try {\r\n    const filmRef = doc(db, COLLECTIONS.FILMS, id);\r\n    const filmDoc = await getDoc(filmRef);\r\n\r\n    if (!filmDoc.exists()) {\r\n      throw new Error('Film non trouv√©');\r\n    }\r\n\r\n    const updateData: Partial<Film> = {\r\n      ...data,\r\n      updatedAt: new Date(),\r\n    };\r\n\r\n    // G√©rer l'upload de la nouvelle affiche\r\n    if (data.poster) {\r\n      const resizedImage = await resizeImage(data.poster, 800, 600);\r\n      const posterRef = ref(storage, `posters/${generateId()}.jpg`);\r\n      await uploadBytes(posterRef, resizedImage);\r\n      updateData.posterUrl = await getDownloadURL(posterRef);\r\n\r\n      // Supprimer l'ancienne affiche\r\n      const currentFilm = filmDoc.data() as Film;\r\n      if (currentFilm.posterUrl) {\r\n        try {\r\n          const oldPosterRef = ref(storage, currentFilm.posterUrl);\r\n          await deleteObject(oldPosterRef);\r\n        } catch (error) {\r\n          console.warn('Impossible de supprimer l\\'ancienne affiche:', error);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Supprimer les champs non-Firestore\r\n    delete (updateData as any).poster;\r\n\r\n    await updateDoc(filmRef, updateData);\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de la mise √† jour du film');\r\n  }\r\n};\r\n\r\n/**\r\n * Supprimer un film\r\n */\r\nexport const deleteFilm = async (id: string): Promise<void> => {\r\n  try {\r\n    const filmRef = doc(db, COLLECTIONS.FILMS, id);\r\n    const filmDoc = await getDoc(filmRef);\r\n\r\n    if (!filmDoc.exists()) {\r\n      throw new Error('Film non trouv√©');\r\n    }\r\n\r\n    // Supprimer l'affiche\r\n    const film = filmDoc.data() as Film;\r\n    if (film.posterUrl) {\r\n      try {\r\n        const posterRef = ref(storage, film.posterUrl);\r\n        await deleteObject(posterRef);\r\n      } catch (error) {\r\n        console.warn('Impossible de supprimer l\\'affiche:', error);\r\n      }\r\n    }\r\n\r\n    await deleteDoc(filmRef);\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de la suppression du film');\r\n  }\r\n};\r\n\r\n/**\r\n * R√©cup√©rer un film par ID\r\n */\r\nexport const getFilm = async (id: string): Promise<Film> => {\r\n  try {\r\n    const filmDoc = await getDoc(doc(db, COLLECTIONS.FILMS, id));\r\n\r\n    if (!filmDoc.exists()) {\r\n      throw new Error('Film non trouv√©');\r\n    }\r\n\r\n    const filmData = filmDoc.data();\r\n    return {\r\n      id: filmDoc.id,\r\n      ...filmData,\r\n      createdAt: filmData.createdAt?.toDate() || new Date(),\r\n      updatedAt: filmData.updatedAt?.toDate() || new Date(),\r\n    } as Film;\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de la r√©cup√©ration du film');\r\n  }\r\n};\r\n\r\n/**\r\n * R√©cup√©rer tous les films\r\n */\r\nexport const getAllFilms = async (): Promise<Film[]> => {\r\n  try {\r\n    const filmsQuery = query(\r\n      collection(db, COLLECTIONS.FILMS),\r\n      orderBy('createdAt', 'desc')\r\n    );\r\n\r\n    const querySnapshot = await getDocs(filmsQuery);\r\n    const films: Film[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const filmData = doc.data();\r\n      films.push({\r\n        id: doc.id,\r\n        ...filmData,\r\n        createdAt: filmData.createdAt?.toDate() || new Date(),\r\n        updatedAt: filmData.updatedAt?.toDate() || new Date(),\r\n      } as Film);\r\n    });\r\n\r\n    return films;\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de la r√©cup√©ration des films');\r\n  }\r\n};\r\n\r\n/**\r\n * √âcouter les changements de la collection films\r\n */\r\nexport const onFilmsChange = (callback: (films: Film[]) => void) => {\r\n  const filmsQuery = query(\r\n    collection(db, COLLECTIONS.FILMS),\r\n    orderBy('createdAt', 'desc')\r\n  );\r\n\r\n  return onSnapshot(filmsQuery, (querySnapshot) => {\r\n    const films: Film[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const filmData = doc.data();\r\n      films.push({\r\n        id: doc.id,\r\n        ...filmData,\r\n        createdAt: filmData.createdAt?.toDate() || new Date(),\r\n        updatedAt: filmData.updatedAt?.toDate() || new Date(),\r\n      } as Film);\r\n    });\r\n\r\n    callback(films);\r\n  });\r\n};\r\n\r\n/**\r\n * Rechercher des films par titre ou r√©alisateur\r\n */\r\nexport const searchFilms = async (searchTerm: string): Promise<Film[]> => {\r\n  try {\r\n    const searchLower = searchTerm.toLowerCase();\r\n    const allFilms = await getAllFilms();\r\n\r\n    return allFilms.filter(\r\n      (film) =>\r\n        film.titre.toLowerCase().includes(searchLower) ||\r\n        film.realisateur.toLowerCase().includes(searchLower)\r\n    );\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de la recherche de films');\r\n  }\r\n}; ","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Clock\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cG9seWxpbmUgcG9pbnRzPSIxMiA2IDEyIDEyIDE2IDE0IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/clock\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Clock = createLucideIcon('Clock', [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['polyline', { points: '12 6 12 12 16 14', key: '68esgv' }],\n]);\n\nexport default Clock;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name MessageSquare\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEgMTVhMiAyIDAgMCAxLTIgMkg3bC00IDRWNWEyIDIgMCAwIDEgMi0yaDE0YTIgMiAwIDAgMSAyIDJ6IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/message-square\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst MessageSquare = createLucideIcon('MessageSquare', [\n  [\n    'path',\n    {\n      d: 'M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z',\n      key: '1lielz',\n    },\n  ],\n]);\n\nexport default MessageSquare;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name CheckCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjIgMTEuMDhWMTJhMTAgMTAgMCAxIDEtNS45My05LjE0IiAvPgogIDxwb2x5bGluZSBwb2ludHM9IjIyIDQgMTIgMTQuMDEgOSAxMS4wMSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/check-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CheckCircle = createLucideIcon('CheckCircle', [\n  ['path', { d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14', key: 'g774vq' }],\n  ['polyline', { points: '22 4 12 14.01 9 11.01', key: '6xbx8j' }],\n]);\n\nexport default CheckCircle;\n","import {\r\n  collection,\r\n  doc,\r\n  deleteDoc,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  orderBy,\r\n  onSnapshot,\r\n  writeBatch,\r\n} from 'firebase/firestore';\r\nimport { db } from './firebase';\r\nimport { Vote, VoteFormData, FilmStats } from '../types';\r\nimport { COLLECTIONS } from '../utils/constants';\r\nimport { generateId, generateSessionId, getUserAgent, getIpAddress } from '../utils/helpers';\r\n\r\n// Queue pour les votes en batch\r\nlet voteQueue: Vote[] = [];\r\nlet batchTimeout: number | null = null;\r\nlet isProcessingBatch = false;\r\n\r\n/**\r\n * Ajouter un vote √† la queue\r\n */\r\nexport const addVoteToQueue = async (\r\n  filmId: string,\r\n  data: VoteFormData,\r\n  user?: { uid: string; email: string } | null,\r\n  sessionId?: string\r\n): Promise<void> => {\r\n  try {\r\n    const vote: Vote = {\r\n      id: generateId(),\r\n      filmId,\r\n      note: data.note,\r\n      commentaire: data.commentaire?.trim(),\r\n      userId: user?.uid,\r\n      userEmail: user?.email,\r\n      userAgent: getUserAgent(),\r\n      ipAddress: await getIpAddress() || undefined,\r\n      sessionId: sessionId || generateSessionId(),\r\n      createdAt: new Date(),\r\n      isAnonymous: !user,\r\n    };\r\n\r\n    voteQueue.push(vote);\r\n\r\n    // D√©marrer le timer pour l'envoi en batch\r\n    if (!batchTimeout) {\r\n      batchTimeout = window.setTimeout(() => {\r\n        processVoteBatch();\r\n      }, 5000); // 5 secondes de d√©lai\r\n    }\r\n\r\n    // V√©rifier si l'utilisateur a d√©j√† vot√© pour ce film\r\n    const hasVoted = await checkIfUserVoted(filmId, user?.uid, sessionId);\r\n    if (hasVoted) {\r\n      throw new Error('Vous avez d√©j√† vot√© pour ce film');\r\n    }\r\n  } catch (error: any) {\r\n    throw new Error(error.message || 'Erreur lors de l\\'ajout du vote');\r\n  }\r\n};\r\n\r\n/**\r\n * Traiter la queue de votes en batch\r\n */\r\nconst processVoteBatch = async (): Promise<void> => {\r\n  if (isProcessingBatch || voteQueue.length === 0) {\r\n    return;\r\n  }\r\n\r\n  isProcessingBatch = true;\r\n  const votesToProcess = [...voteQueue];\r\n  voteQueue = [];\r\n  batchTimeout = null;\r\n\r\n  try {\r\n    const batch = writeBatch(db);\r\n\r\n    // Ajouter tous les votes au batch\r\n    votesToProcess.forEach((vote) => {\r\n      const voteRef = doc(collection(db, COLLECTIONS.VOTES));\r\n      batch.set(voteRef, {\r\n        ...vote,\r\n        id: voteRef.id,\r\n      });\r\n    });\r\n\r\n    // Ex√©cuter le batch\r\n    await batch.commit();\r\n\r\n    console.log(`${votesToProcess.length} votes envoy√©s avec succ√®s`);\r\n  } catch (error) {\r\n    console.error('Erreur lors de l\\'envoi du batch:', error);\r\n    \r\n    // Remettre les votes dans la queue pour retry\r\n    voteQueue.unshift(...votesToProcess);\r\n    \r\n    // Retry apr√®s 10 secondes\r\n    setTimeout(() => {\r\n      isProcessingBatch = false;\r\n      if (voteQueue.length > 0) {\r\n        processVoteBatch();\r\n      }\r\n    }, 10000);\r\n  } finally {\r\n    isProcessingBatch = false;\r\n  }\r\n};\r\n\r\n/**\r\n * V√©rifier si un utilisateur a d√©j√† vot√© pour un film\r\n */\r\nexport const checkIfUserVoted = async (\r\n  filmId: string,\r\n  userId?: string,\r\n  sessionId?: string\r\n): Promise<boolean> => {\r\n  try {\r\n    let voteQuery;\r\n\r\n    if (userId) {\r\n      // Utilisateur connect√©\r\n      voteQuery = query(\r\n        collection(db, COLLECTIONS.VOTES),\r\n        where('filmId', '==', filmId),\r\n        where('userId', '==', userId)\r\n      );\r\n    } else if (sessionId) {\r\n      // Vote anonyme\r\n      voteQuery = query(\r\n        collection(db, COLLECTIONS.VOTES),\r\n        where('filmId', '==', filmId),\r\n        where('sessionId', '==', sessionId)\r\n      );\r\n    } else {\r\n      return false;\r\n    }\r\n\r\n    const querySnapshot = await getDocs(voteQuery);\r\n    return !querySnapshot.empty;\r\n  } catch (error) {\r\n    console.error('Erreur lors de la v√©rification du vote:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * R√©cup√©rer les votes d'un film\r\n */\r\nexport const getFilmVotes = async (filmId: string): Promise<Vote[]> => {\r\n  try {\r\n    const votesQuery = query(\r\n      collection(db, COLLECTIONS.VOTES),\r\n      where('filmId', '==', filmId),\r\n      orderBy('createdAt', 'desc')\r\n    );\r\n\r\n    const querySnapshot = await getDocs(votesQuery);\r\n    const votes: Vote[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const voteData = doc.data();\r\n      votes.push({\r\n        ...voteData,\r\n        id: doc.id,\r\n        createdAt: voteData.createdAt?.toDate() || new Date(),\r\n      } as Vote);\r\n    });\r\n\r\n    return votes;\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de la r√©cup√©ration des votes');\r\n  }\r\n};\r\n\r\n/**\r\n * Supprimer un vote\r\n */\r\nexport const deleteVote = async (voteId: string): Promise<void> => {\r\n  try {\r\n    await deleteDoc(doc(db, COLLECTIONS.VOTES, voteId));\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors de la suppression du vote');\r\n  }\r\n};\r\n\r\n/**\r\n * R√©cup√©rer les statistiques d'un film\r\n */\r\nexport const getFilmStats = async (filmId: string): Promise<FilmStats> => {\r\n  try {\r\n    const votes = await getFilmVotes(filmId);\r\n    const ratings = votes.map(vote => vote.note);\r\n    \r\n    const distribution: Record<number, number> = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };\r\n    ratings.forEach(rating => {\r\n      if (rating >= 1 && rating <= 5) {\r\n        distribution[rating]++;\r\n      }\r\n    });\r\n\r\n    const moyenne = ratings.length > 0 \r\n      ? Math.round((ratings.reduce((sum, r) => sum + r, 0) / ratings.length) * 10) / 10\r\n      : 0;\r\n\r\n    const commentaires = votes\r\n      .filter(vote => vote.commentaire)\r\n      .map(vote => vote.commentaire!)\r\n      .slice(0, 10); // Limiter √† 10 commentaires\r\n\r\n    return {\r\n      filmId,\r\n      titre: '', // Sera rempli par l'appelant\r\n      totalVotes: votes.length,\r\n      moyenneNote: moyenne,\r\n      distributionNotes: distribution,\r\n      commentaires,\r\n    };\r\n  } catch (error: any) {\r\n    throw new Error('Erreur lors du calcul des statistiques');\r\n  }\r\n};\r\n\r\n/**\r\n * √âcouter les changements de votes pour un film\r\n */\r\nexport const onVotesChange = (filmId: string, callback: (votes: Vote[]) => void) => {\r\n  const votesQuery = query(\r\n    collection(db, COLLECTIONS.VOTES),\r\n    where('filmId', '==', filmId),\r\n    orderBy('createdAt', 'desc')\r\n  );\r\n\r\n  return onSnapshot(votesQuery, (querySnapshot) => {\r\n    const votes: Vote[] = [];\r\n\r\n    querySnapshot.forEach((doc) => {\r\n      const voteData = doc.data();\r\n      votes.push({\r\n        ...voteData,\r\n        id: doc.id,\r\n        createdAt: voteData.createdAt?.toDate() || new Date(),\r\n      } as Vote);\r\n    });\r\n\r\n    callback(votes);\r\n  });\r\n};\r\n\r\n/**\r\n * R√©cup√©rer le statut de la queue de votes\r\n */\r\nexport const getVoteQueueStatus = () => {\r\n  return {\r\n    pendingVotes: voteQueue.length,\r\n    isProcessing: isProcessingBatch,\r\n    nextBatchIn: batchTimeout ? 5000 : 0,\r\n  };\r\n};\r\n\r\n/**\r\n * Forcer l'envoi imm√©diat de la queue\r\n */\r\nexport const forceProcessBatch = async (): Promise<void> => {\r\n  if (batchTimeout) {\r\n    clearTimeout(batchTimeout);\r\n    batchTimeout = null;\r\n  }\r\n  await processVoteBatch();\r\n}; ","import React, { useState, useEffect } from 'react';\r\nimport { Star, MessageSquare, CheckCircle, Clock } from 'lucide-react';\r\nimport { useForm } from 'react-hook-form';\r\nimport { zodResolver } from '@hookform/resolvers/zod';\r\nimport { z } from 'zod';\r\nimport toast from 'react-hot-toast';\r\nimport { Film, VoteFormData } from '../types';\r\nimport { getAllFilms } from '../services/filmService';\r\nimport { addVoteToQueue, getVoteQueueStatus } from '../services/voteService';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { generateSessionId, getLocalStorage, setLocalStorage } from '../utils/helpers';\r\nimport { SUCCESS_MESSAGES, ERROR_MESSAGES } from '../utils/constants';\r\n\r\n// Sch√©ma de validation pour le vote\r\nconst voteSchema = z.object({\r\n  note: z.number().min(1).max(5),\r\n  commentaire: z.string().max(500).optional(),\r\n});\r\n\r\nexport const VotePage: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const [films, setFilms] = useState<Film[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [selectedFilm, setSelectedFilm] = useState<Film | null>(null);\r\n  const [queueStatus, setQueueStatus] = useState({ pendingVotes: 0, isProcessing: false, nextBatchIn: 0 });\r\n  const [sessionId] = useState(() => {\r\n    const existing = getLocalStorage('voteSessionId', '');\r\n    if (!existing) {\r\n      const newId = generateSessionId();\r\n      setLocalStorage('voteSessionId', newId);\r\n      return newId;\r\n    }\r\n    return existing;\r\n  });\r\n\r\n  const {\r\n    register,\r\n    handleSubmit,\r\n    setValue,\r\n    watch,\r\n    formState: { errors, isSubmitting },\r\n    reset,\r\n  } = useForm<VoteFormData>({\r\n    resolver: zodResolver(voteSchema),\r\n    defaultValues: {\r\n      note: 0,\r\n      commentaire: '',\r\n    },\r\n  });\r\n\r\n  const watchedNote = watch('note');\r\n\r\n  // Charger les films\r\n  useEffect(() => {\r\n    const loadFilms = async () => {\r\n      try {\r\n        const filmsData = await getAllFilms();\r\n        setFilms(filmsData);\r\n      } catch (error) {\r\n        toast.error(ERROR_MESSAGES.NETWORK_ERROR);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    loadFilms();\r\n  }, []);\r\n\r\n  // Surveiller le statut de la queue\r\n  useEffect(() => {\r\n    const interval = setInterval(() => {\r\n      const status = getVoteQueueStatus();\r\n      setQueueStatus(status);\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // G√©rer la s√©lection d'une note\r\n  const handleRatingChange = (rating: number) => {\r\n    setValue('note', rating);\r\n  };\r\n\r\n  // Soumettre le vote\r\n  const onSubmit = async (data: VoteFormData) => {\r\n    if (!selectedFilm) {\r\n      toast.error('Veuillez s√©lectionner un film');\r\n      return;\r\n    }\r\n\r\n    try {\r\n      await addVoteToQueue(\r\n        selectedFilm.id,\r\n        data,\r\n        user ? { uid: user.uid, email: user.email } : null,\r\n        sessionId\r\n      );\r\n\r\n      toast.success(SUCCESS_MESSAGES.VOTE_PENDING);\r\n      reset();\r\n      setSelectedFilm(null);\r\n    } catch (error: any) {\r\n      toast.error(error.message || ERROR_MESSAGES.VOTE_ERROR);\r\n    }\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto\"></div>\r\n          <p className=\"mt-4 text-gray-600\">Chargement des films...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-50\">\r\n      {/* Header */}\r\n      <header className=\"bg-white shadow-sm\">\r\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\r\n          <div className=\"flex justify-between items-center py-6\">\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-primary-600\">Voter pour un film</h1>\r\n              <p className=\"text-secondary-600 mt-1\">\r\n                Donnez votre avis sur les films du festival\r\n              </p>\r\n            </div>\r\n            \r\n            {/* Statut de la queue */}\r\n            <div className=\"flex items-center space-x-4\">\r\n              {queueStatus.pendingVotes > 0 && (\r\n                <div className=\"flex items-center space-x-2 text-sm text-secondary-600\">\r\n                  <Clock className=\"w-4 h-4\" />\r\n                  <span>{queueStatus.pendingVotes} vote(s) en attente</span>\r\n                </div>\r\n              )}\r\n              {queueStatus.isProcessing && (\r\n                <div className=\"flex items-center space-x-2 text-sm text-primary-600\">\r\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600\"></div>\r\n                  <span>Envoi en cours...</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\r\n        {films.length === 0 ? (\r\n          <div className=\"text-center py-12\">\r\n            <div className=\"text-6xl mb-4\">üé¨</div>\r\n            <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Aucun film disponible</h2>\r\n            <p className=\"text-gray-600\">Les films seront ajout√©s par l'administrateur.</p>\r\n          </div>\r\n        ) : (\r\n          <div className=\"grid lg:grid-cols-2 gap-8\">\r\n            {/* Liste des films */}\r\n            <div>\r\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Films en comp√©tition</h2>\r\n              <div className=\"space-y-4\">\r\n                {films.map((film) => (\r\n                  <div\r\n                    key={film.id}\r\n                    className={`card cursor-pointer transition-all ${\r\n                      selectedFilm?.id === film.id\r\n                        ? 'ring-2 ring-primary-500 bg-primary-50'\r\n                        : 'hover:shadow-md'\r\n                    }`}\r\n                    onClick={() => setSelectedFilm(film)}\r\n                  >\r\n                    <div className=\"flex space-x-4\">\r\n                      {film.posterUrl && (\r\n                        <img\r\n                          src={film.posterUrl}\r\n                          alt={film.titre}\r\n                          className=\"w-16 h-24 object-cover rounded-lg\"\r\n                        />\r\n                      )}\r\n                      <div className=\"flex-1\">\r\n                        <h3 className=\"font-semibold text-gray-900\">{film.titre}</h3>\r\n                        <p className=\"text-sm text-gray-600 mb-2\">R√©alis√© par {film.realisateur}</p>\r\n                        <p className=\"text-sm text-gray-700 line-clamp-2\">{film.synopsis}</p>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Formulaire de vote */}\r\n            <div>\r\n              <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">Votre vote</h2>\r\n              \r\n              {selectedFilm ? (\r\n                <div className=\"card\">\r\n                  <div className=\"mb-6\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n                      {selectedFilm.titre}\r\n                    </h3>\r\n                    <p className=\"text-sm text-gray-600 mb-4\">\r\n                      R√©alis√© par {selectedFilm.realisateur}\r\n                    </p>\r\n                    {selectedFilm.posterUrl && (\r\n                      <img\r\n                        src={selectedFilm.posterUrl}\r\n                        alt={selectedFilm.titre}\r\n                        className=\"w-full h-48 object-cover rounded-lg mb-4\"\r\n                      />\r\n                    )}\r\n                    <p className=\"text-gray-700\">{selectedFilm.synopsis}</p>\r\n                  </div>\r\n\r\n                  <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\r\n                    {/* Syst√®me de notation */}\r\n                    <div>\r\n                      <label className=\"form-label\">Votre note</label>\r\n                      <div className=\"star-rating\">\r\n                        {[1, 2, 3, 4, 5].map((star) => (\r\n                          <button\r\n                            key={star}\r\n                            type=\"button\"\r\n                            onClick={() => handleRatingChange(star)}\r\n                            className={`star ${\r\n                              star <= watchedNote ? 'star-filled' : 'star-empty'\r\n                            }`}\r\n                          >\r\n                            <Star className=\"w-8 h-8\" fill={star <= watchedNote ? 'currentColor' : 'none'} />\r\n                          </button>\r\n                        ))}\r\n                      </div>\r\n                      <p className=\"text-sm text-gray-600 mt-2\">\r\n                        {watchedNote > 0 ? `${watchedNote}/5 √©toiles` : 'Cliquez sur les √©toiles pour noter'}\r\n                      </p>\r\n                      {errors.note && (\r\n                        <p className=\"form-error\">{errors.note.message}</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Commentaire */}\r\n                    <div>\r\n                      <label className=\"form-label\">\r\n                        <MessageSquare className=\"w-4 h-4 inline mr-2\" />\r\n                        Commentaire (optionnel)\r\n                      </label>\r\n                      <textarea\r\n                        {...register('commentaire')}\r\n                        rows={4}\r\n                        className=\"input-field\"\r\n                        placeholder=\"Partagez votre avis sur ce film...\"\r\n                        maxLength={500}\r\n                      />\r\n                      {errors.commentaire && (\r\n                        <p className=\"form-error\">{errors.commentaire.message}</p>\r\n                      )}\r\n                    </div>\r\n\r\n                    {/* Bouton de soumission */}\r\n                    <button\r\n                      type=\"submit\"\r\n                      disabled={isSubmitting || watchedNote === 0}\r\n                      className=\"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                      {isSubmitting ? (\r\n                        <div className=\"flex items-center justify-center\">\r\n                          <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\r\n                          Envoi en cours...\r\n                        </div>\r\n                      ) : (\r\n                        <div className=\"flex items-center justify-center\">\r\n                          <CheckCircle className=\"w-4 h-4 mr-2\" />\r\n                          Envoyer mon vote\r\n                        </div>\r\n                      )}\r\n                    </button>\r\n                  </form>\r\n                </div>\r\n              ) : (\r\n                <div className=\"card text-center py-12\">\r\n                  <div className=\"text-6xl mb-4\">‚≠ê</div>\r\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\r\n                    S√©lectionnez un film\r\n                  </h3>\r\n                  <p className=\"text-gray-600\">\r\n                    Cliquez sur un film dans la liste pour commencer √† voter\r\n                  </p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}; "],"names":["getAllFilms","async","filmsQuery","query","collection","db","COLLECTIONS","FILMS","orderBy","querySnapshot","getDocs","films","forEach","doc","_filmData$createdAt2","_filmData$updatedAt2","filmData","data","push","id","createdAt","toDate","Date","updatedAt","error","Error","Clock","createLucideIcon","cx","cy","r","key","points","MessageSquare","d","CheckCircle","voteQueue","batchTimeout","isProcessingBatch","processVoteBatch","length","votesToProcess","batch","writeBatch","vote","voteRef","VOTES","set","commit","console","log","unshift","setTimeout","checkIfUserVoted","filmId","userId","sessionId","voteQuery","where","empty","voteSchema","z","note","min","max","commentaire","optional","VotePage","user","useAuth","setFilms","useState","loading","setLoading","selectedFilm","setSelectedFilm","queueStatus","setQueueStatus","pendingVotes","isProcessing","nextBatchIn","existing","getLocalStorage","newId","generateSessionId","setLocalStorage","register","handleSubmit","setValue","watch","formState","errors","isSubmitting","reset","useForm","resolver","zodResolver","defaultValues","watchedNote","useEffect","filmsData","toast","ERROR_MESSAGES","NETWORK_ERROR","loadFilms","interval","setInterval","status","clearInterval","_jsx","className","children","_jsxs","map","film","onClick","posterUrl","src","alt","titre","realisateur","synopsis","onSubmit","_data$commentaire","generateId","trim","uid","userEmail","email","userAgent","getUserAgent","ipAddress","getIpAddress","undefined","isAnonymous","window","message","addVoteToQueue","success","SUCCESS_MESSAGES","VOTE_PENDING","VOTE_ERROR","star","type","Star","fill","rows","placeholder","maxLength","disabled"],"sourceRoot":""}