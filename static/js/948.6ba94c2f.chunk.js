/*! For license information please see 948.6ba94c2f.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkprix_du_public=self.webpackChunkprix_du_public||[]).push([[948],{948:(e,s,a)=>{a.r(s),a.d(s,{VotePage:()=>v});var t=a(5043),r=a(5088),l=a(3944);const i=(0,a(1639).A)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);var n=a(4319),c=a(4858),m=a(1850),d=a(880),o=a(3768),x=a(1146),h=a(5168),u=a(4292),p=a(6925),j=a(4413),N=a(579);const y=d.Ik({note:d.ai().min(1).max(5),commentaire:d.Yj().max(500).optional()}),v=()=>{const{user:e}=(0,u.A)(),[s,a]=(0,t.useState)([]),[d,v]=(0,t.useState)(!0),[f,b]=(0,t.useState)(null),[g,w]=(0,t.useState)({pendingVotes:0,isProcessing:!1,nextBatchIn:0}),[V]=(0,t.useState)(()=>{const e=(0,p.Lg)("voteSessionId","");if(!e){const e=(0,p.f6)();return(0,p.ZB)("voteSessionId",e),e}return e}),{register:S,handleSubmit:A,setValue:k,watch:E,formState:{errors:C,isSubmitting:R},reset:z}=(0,c.mN)({resolver:(0,m.u)(y),defaultValues:{note:0,commentaire:""}}),U=E("note");(0,t.useEffect)(()=>{(async()=>{try{const e=await(0,x.Vm)();a(e)}catch(e){o.Ay.error(j.UU.NETWORK_ERROR)}finally{v(!1)}})()},[]),(0,t.useEffect)(()=>{const e=setInterval(()=>{const e=(0,h.yq)();w(e)},1e3);return()=>clearInterval(e)},[]);return d?(0,N.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,N.jsxs)("div",{className:"text-center",children:[(0,N.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,N.jsx)("p",{className:"mt-4 text-gray-600",children:"Chargement des films..."})]})}):(0,N.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,N.jsx)("header",{className:"bg-white shadow-sm",children:(0,N.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,N.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("h1",{className:"text-3xl font-bold text-primary-600",children:"Voter pour un film"}),(0,N.jsx)("p",{className:"text-secondary-600 mt-1",children:"Donnez votre avis sur les films du festival"})]}),(0,N.jsxs)("div",{className:"flex items-center space-x-4",children:[g.pendingVotes>0&&(0,N.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-secondary-600",children:[(0,N.jsx)(r.A,{className:"w-4 h-4"}),(0,N.jsxs)("span",{children:[g.pendingVotes," vote(s) en attente"]})]}),g.isProcessing&&(0,N.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-primary-600",children:[(0,N.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),(0,N.jsx)("span",{children:"Envoi en cours..."})]})]})]})})}),(0,N.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:0===s.length?(0,N.jsxs)("div",{className:"text-center py-12",children:[(0,N.jsx)("div",{className:"text-6xl mb-4",children:"\ud83c\udfac"}),(0,N.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Aucun film disponible"}),(0,N.jsx)("p",{className:"text-gray-600",children:"Les films seront ajout\xe9s par l'administrateur."})]}):(0,N.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Films en comp\xe9tition"}),(0,N.jsx)("div",{className:"space-y-4",children:s.map(e=>(0,N.jsx)("div",{className:"card cursor-pointer transition-all "+((null===f||void 0===f?void 0:f.id)===e.id?"ring-2 ring-primary-500 bg-primary-50":"hover:shadow-md"),onClick:()=>b(e),children:(0,N.jsxs)("div",{className:"flex space-x-4",children:[e.posterUrl&&(0,N.jsx)("img",{src:e.posterUrl,alt:e.titre,className:"w-16 h-24 object-cover rounded-lg"}),(0,N.jsxs)("div",{className:"flex-1",children:[(0,N.jsx)("h3",{className:"font-semibold text-gray-900",children:e.titre}),(0,N.jsxs)("p",{className:"text-sm text-gray-600 mb-2",children:["R\xe9alis\xe9 par ",e.realisateur]}),(0,N.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.synopsis})]})]})},e.id))})]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Votre vote"}),f?(0,N.jsxs)("div",{className:"card",children:[(0,N.jsxs)("div",{className:"mb-6",children:[(0,N.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:f.titre}),(0,N.jsxs)("p",{className:"text-sm text-gray-600 mb-4",children:["R\xe9alis\xe9 par ",f.realisateur]}),f.posterUrl&&(0,N.jsx)("img",{src:f.posterUrl,alt:f.titre,className:"w-full h-48 object-cover rounded-lg mb-4"}),(0,N.jsx)("p",{className:"text-gray-700",children:f.synopsis})]}),(0,N.jsxs)("form",{onSubmit:A(async s=>{if(f)try{await(0,h.yc)(f.id,s,e?{uid:e.uid,email:e.email}:null,V),o.Ay.success(j.PL.VOTE_PENDING),z(),b(null)}catch(a){o.Ay.error(a.message||j.UU.VOTE_ERROR)}else o.Ay.error("Veuillez s\xe9lectionner un film")}),className:"space-y-6",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("label",{className:"form-label",children:"Votre note"}),(0,N.jsx)("div",{className:"star-rating",children:[1,2,3,4,5].map(e=>(0,N.jsx)("button",{type:"button",onClick:()=>{k("note",e)},className:"star "+(e<=U?"star-filled":"star-empty"),children:(0,N.jsx)(l.A,{className:"w-8 h-8",fill:e<=U?"currentColor":"none"})},e))}),(0,N.jsx)("p",{className:"text-sm text-gray-600 mt-2",children:U>0?`${U}/5 \xe9toiles`:"Cliquez sur les \xe9toiles pour noter"}),C.note&&(0,N.jsx)("p",{className:"form-error",children:C.note.message})]}),(0,N.jsxs)("div",{children:[(0,N.jsxs)("label",{className:"form-label",children:[(0,N.jsx)(i,{className:"w-4 h-4 inline mr-2"}),"Commentaire (optionnel)"]}),(0,N.jsx)("textarea",{...S("commentaire"),rows:4,className:"input-field",placeholder:"Partagez votre avis sur ce film...",maxLength:500}),C.commentaire&&(0,N.jsx)("p",{className:"form-error",children:C.commentaire.message})]}),(0,N.jsx)("button",{type:"submit",disabled:R||0===U,className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:R?(0,N.jsxs)("div",{className:"flex items-center justify-center",children:[(0,N.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Envoi en cours..."]}):(0,N.jsxs)("div",{className:"flex items-center justify-center",children:[(0,N.jsx)(n.A,{className:"w-4 h-4 mr-2"}),"Envoyer mon vote"]})})]})]}):(0,N.jsxs)("div",{className:"card text-center py-12",children:[(0,N.jsx)("div",{className:"text-6xl mb-4",children:"\u2b50"}),(0,N.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"S\xe9lectionnez un film"}),(0,N.jsx)("p",{className:"text-gray-600",children:"Cliquez sur un film dans la liste pour commencer \xe0 voter"})]})]})]})})]})}},5088:(e,s,a)=>{a.d(s,{A:()=>t});const t=(0,a(1639).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])}}]);
//# sourceMappingURL=948.6ba94c2f.chunk.js.map