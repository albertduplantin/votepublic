/*! For license information please see 886.75493e7f.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkprix_du_public=self.webpackChunkprix_du_public||[]).push([[886],{1146:(e,r,t)=>{t.d(r,{Vm:()=>n,XP:()=>i,xJ:()=>c});var a=t(4455),o=t(5472);t(8147),t(6925);const s="films",n=async()=>{try{const e=(0,o.P)((0,o.rJ)(a.db,s),(0,o.My)("titre","asc")),r=await(0,o.GG)(e),t=[];return r.forEach(e=>{const r=e.data();t.push({id:e.id,titre:r.titre,realisateur:r.realisateur,pays:r.pays,duree:r.duree,annee:r.annee,synopsis:r.synopsis,posterUrl:r.posterUrl,genre:r.genre,createdAt:r.createdAt.toDate(),updatedAt:r.updatedAt.toDate()})}),t}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration des films:",e),e}},i=async e=>{try{const r=(0,o.H9)(a.db,s,e),t=await(0,o.x7)(r);if(t.exists()){const e=t.data();return{id:t.id,titre:e.titre,realisateur:e.realisateur,pays:e.pays,duree:e.duree,annee:e.annee,synopsis:e.synopsis,posterUrl:e.posterUrl,genre:e.genre,createdAt:e.createdAt.toDate(),updatedAt:e.updatedAt.toDate()}}return null}catch(r){throw console.error("Erreur lors de la r\xe9cup\xe9ration du film:",r),r}},c=async e=>{try{if(0===e.length)return[];const r=e.map(e=>i(e));return(await Promise.all(r)).filter(e=>null!==e)}catch(r){throw console.error("Erreur lors de la r\xe9cup\xe9ration des films par IDs:",r),r}}},3388:(e,r,t)=>{t.d(r,{$:()=>s});t(5043);var a=t(6925),o=t(579);const s=e=>{let{variant:r="primary",size:t="md",loading:s=!1,icon:n,children:i,className:c,disabled:d,...l}=e;return(0,o.jsxs)("button",{className:(0,a.cn)("inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",{primary:"bg-primary text-white hover:bg-primary-dark focus:ring-primary border-2 border-primary",secondary:"bg-gray-600 text-white hover:bg-gray-700 focus:ring-gray-500",outline:"border-2 border-primary bg-white text-primary hover:bg-primary hover:text-white focus:ring-primary",ghost:"text-gray-700 hover:bg-gray-100 focus:ring-gray-500",danger:"bg-red-600 text-white hover:bg-red-700 focus:ring-red-500"}[r],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-sm",lg:"px-6 py-3 text-base"}[t],c),disabled:d||s,...l,children:[s&&(0,o.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",fill:"none",viewBox:"0 0 24 24",children:[(0,o.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,o.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),!s&&n&&(0,o.jsx)("span",{className:"mr-2",children:n}),i]})}},4230:(e,r,t)=>{t.d(r,{Z:()=>s});t(5043);var a=t(6925),o=t(579);const s=e=>{let{children:r,className:t,padding:s="md",shadow:n="md"}=e;return(0,o.jsx)("div",{className:(0,a.cn)("bg-white rounded-lg border border-gray-200",{none:"",sm:"p-4",md:"p-6",lg:"p-8"}[s],{none:"",sm:"shadow-sm",md:"shadow-md",lg:"shadow-lg"}[n],t),children:r})}},5088:(e,r,t)=>{t.d(r,{A:()=>a});const a=(0,t(1639).A)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},5168:(e,r,t)=>{t.d(r,{MS:()=>y,_M:()=>l,yc:()=>u,yq:()=>p});var a=t(5472),o=t(4455),s=t(4413),n=t(6925);let i=[],c=null,d=!1;const l=async e=>{try{var r;const t=await(0,n.SP)(),i={id:(0,n.$C)(),filmId:e.filmId,seanceId:e.seanceId||"",note:e.note,userAgent:(0,n.$t)(),sessionId:(0,n.f6)(),createdAt:new Date,...(null===(r=e.commentaire)||void 0===r?void 0:r.trim())&&{commentaire:e.commentaire.trim()},...t&&{ipAddress:t}},c=(0,a.H9)((0,a.rJ)(o.db,s.I.VOTES));await(0,a.BN)(c,{...i,id:c.id})}catch(t){throw new Error("Erreur lors de l'ajout du vote")}},u=async(e,r,t,a)=>{try{var o;const s=await(0,n.SP)(),d={id:(0,n.$C)(),filmId:e,seanceId:"",note:r.note,userAgent:(0,n.$t)(),sessionId:a||(0,n.f6)(),createdAt:new Date,...(null===(o=r.commentaire)||void 0===o?void 0:o.trim())&&{commentaire:r.commentaire.trim()},...s&&{ipAddress:s}};i.push(d),c||(c=window.setTimeout(()=>{m()},5e3));if(await h(e,null===t||void 0===t?void 0:t.uid,a))throw new Error("Vous avez d\xe9j\xe0 vot\xe9 pour ce film")}catch(s){throw new Error(s.message||"Erreur lors de l'ajout du vote")}},m=async()=>{if(d||0===i.length)return;d=!0;const e=[...i];i=[],c=null;try{const r=(0,a.wP)(o.db);e.forEach(e=>{const t=(0,a.H9)((0,a.rJ)(o.db,s.I.VOTES));r.set(t,{...e,id:t.id})}),await r.commit(),console.log(`${e.length} votes envoy\xe9s avec succ\xe8s`)}catch(r){console.error("Erreur lors de l'envoi du batch:",r),i.unshift(...e),setTimeout(()=>{d=!1,i.length>0&&m()},1e4)}finally{d=!1}},h=async(e,r,t)=>{try{let n;if(r)n=(0,a.P)((0,a.rJ)(o.db,s.I.VOTES),(0,a._M)("filmId","==",e),(0,a._M)("userId","==",r));else{if(!t)return!1;n=(0,a.P)((0,a.rJ)(o.db,s.I.VOTES),(0,a._M)("filmId","==",e),(0,a._M)("sessionId","==",t))}return!(await(0,a.GG)(n)).empty}catch(n){return console.error("Erreur lors de la v\xe9rification du vote:",n),!1}},p=()=>({pendingVotes:i.length,isProcessing:d,nextBatchIn:c?5e3:0}),y=async e=>{try{const r=(0,a.P)((0,a.rJ)(o.db,s.I.VOTES),(0,a._M)("seanceId","==",e),(0,a.My)("createdAt","desc")),t=await(0,a.GG)(r),n=[];t.forEach(e=>{var r;const t=e.data();n.push({...t,id:e.id,createdAt:(null===(r=t.createdAt)||void 0===r?void 0:r.toDate())||new Date})});const i={};n.forEach(e=>{i[e.filmId]||(i[e.filmId]=[]),i[e.filmId].push(e)});const c=Object.entries(i).map(e=>{let[r,t]=e;const a=t.map(e=>e.note),o={1:0,2:0,3:0,4:0,5:0};a.forEach(e=>{e>=1&&e<=5&&o[e]++});const s=a.length>0?Math.round(a.reduce((e,r)=>e+r,0)/a.length*10)/10:0;return{filmId:r,titre:"",totalVotes:t.length,moyenneNote:s,distributionNotes:o}});return{seanceId:e,totalVotes:n.length,films:c}}catch(r){throw new Error("Erreur lors de la r\xe9cup\xe9ration des r\xe9sultats de la s\xe9ance")}}},6925:(e,r,t)=>{t.d(r,{$C:()=>a,$t:()=>s,Lg:()=>c,SP:()=>n,ZB:()=>i,cn:()=>d,f6:()=>o});t(4413);const a=()=>Date.now().toString(36)+Math.random().toString(36).substring(2),o=()=>`${Date.now()}-${Math.random().toString(36).substring(2)}`,s=()=>navigator.userAgent,n=async()=>{try{const e=await fetch("https://api.ipify.org?format=json");return(await e.json()).ip}catch(e){return console.warn("Impossible de r\xe9cup\xe9rer l'IP:",e),null}},i=(e,r)=>{try{localStorage.setItem(e,JSON.stringify(r))}catch(t){console.warn("Erreur lors du stockage local:",t)}},c=(e,r)=>{try{const t=localStorage.getItem(e);return t?JSON.parse(t):r}catch(t){return console.warn("Erreur lors de la r\xe9cup\xe9ration locale:",t),r}},d=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];return r.filter(Boolean).join(" ")}},7929:(e,r,t)=>{t.d(r,{L6:()=>u,Si:()=>l,We:()=>h,Xb:()=>m,gc:()=>c,q5:()=>d});var a=t(4455),o=t(5472),s=t(6925);const n="seances",i="films",c=async e=>{try{if(5!==e.films.length)throw new Error("Une s\xe9ance doit contenir exactement 5 films");const r=e.films.map(e=>(0,o.x7)((0,o.H9)(a.db,i,e))),t=(await Promise.all(r)).map((r,t)=>({snapshot:r,filmId:e.films[t]})).filter(e=>{let{snapshot:r}=e;return!r.exists()});if(t.length>0)throw new Error(`Films non trouv\xe9s: ${t.map(e=>e.filmId).join(", ")}`);const c=(0,s.$C)(),d=p(c),l={nom:e.nom,date:e.date,heure:e.heure,films:e.films,qrCodeUrl:d,isActive:!0,createdAt:new Date,updatedAt:new Date,...e.description&&{description:e.description}};return{id:(await(0,o.gS)((0,o.rJ)(a.db,n),l)).id,...l}}catch(r){throw console.error("Erreur lors de la cr\xe9ation de la s\xe9ance:",r),r}},d=async()=>{try{const e=(0,o.P)((0,o.rJ)(a.db,n),(0,o.My)("date","desc")),r=await(0,o.GG)(e),t=[];return r.forEach(e=>{const r=e.data();t.push({id:e.id,nom:r.nom,description:r.description,date:r.date.toDate(),heure:r.heure,films:r.films,qrCodeUrl:r.qrCodeUrl,isActive:r.isActive,createdAt:r.createdAt.toDate(),updatedAt:r.updatedAt.toDate()})}),t}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration des s\xe9ances:",e),e}},l=async e=>{try{const r=(0,o.H9)(a.db,n,e),t=await(0,o.x7)(r);if(t.exists()){const e=t.data();return{id:t.id,nom:e.nom,description:e.description,date:e.date.toDate(),heure:e.heure,films:e.films,qrCodeUrl:e.qrCodeUrl,isActive:e.isActive,createdAt:e.createdAt.toDate(),updatedAt:e.updatedAt.toDate()}}return null}catch(r){throw console.error("Erreur lors de la r\xe9cup\xe9ration de la s\xe9ance:",r),r}},u=async(e,r)=>{try{const t=(0,o.H9)(a.db,n,e),s={...r,updatedAt:new Date};if(r.films&&5!==r.films.length)throw new Error("Une s\xe9ance doit contenir exactement 5 films");await(0,o.mZ)(t,s)}catch(t){throw console.error("Erreur lors de la mise \xe0 jour de la s\xe9ance:",t),t}},m=async e=>{try{const r=(0,o.H9)(a.db,n,e);await(0,o.kd)(r)}catch(r){throw console.error("Erreur lors de la suppression de la s\xe9ance:",r),r}},h=async(e,r)=>{try{const t=(0,o.H9)(a.db,n,e);await(0,o.mZ)(t,{isActive:r,updatedAt:new Date})}catch(t){throw console.error("Erreur lors de la modification du statut de la s\xe9ance:",t),t}},p=e=>{const r=window.location.origin;return`https://api.qrserver.com/v1/create-qr-code/?${new URLSearchParams({size:"300x300",data:`${r}/seance/${e}`,format:"png"}).toString()}`}}}]);
//# sourceMappingURL=886.75493e7f.chunk.js.map